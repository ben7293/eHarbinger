<?php
include_once("classes.php");
include_once("session.php");
session_start();

function addUser($user, $pxwd, $email){
	$db = new Database();
	if (!$db->queryTrueFalse("select userExists('$user')")){
		// If username does not exist
		if ($db->queryTrueFalse("select insertUser('$user', '$pxwd', '$email')")){
			// Add user information to database
			// Log the user in
			login($user, $pxwd, $db);
			$_SESSION["completedPref"] = FALSE;
			header("Location: signup.php");
		}
	}
	else{
		//Complain
		header("Location: index.php?err=2");
	}
	
}

// // if (isset($_SESSION["completedPref"])){
	// // if (!$_SESSION["completedPref"]){
		// //Create csv formatted description
		// $prefCsv = "";
		
		// if (isset($_POST["Preferences"])){
			// foreach ($_POST["Preferences"] as $pref){
				// if ($prefCsv == ""){
					// // First item
					// $prefCsv = $pref;
				// }
				// else{
					// // Following item
					// $prefCsv = $prefCsv . ", " . $pref;
				// }
			// }
		// }
		
		// //Send profile data to database
		// $username = $_SESSION["user"]->getName();
		// $name = $_POST["name"];
		// $location = $_POST["location"];
		// $lang = $_POST["lang"];

		// // Update profile
		// $status = $_SESSION["user"]->upProf($username, $name, $location, $lang, $prefCsv);
		// if ($status){
			// // Remove profile incomplete marker
			// unset($_SESSION["completedPref"]);
		// }
	// // }
// // }
// // header("Location: players.php");

?>

<DOCTYPE HTML!>
	<html>
		<head>
		<meta charset="utf-8"> 
        	<title>eHarbinger</title>
        	<link rel="stylesheet" type="text/css" href="css/main.css">
        	<script type="text/javascript" src = "design.js"></script>
		</head>
		<body>
		<header id = 'banner'>
			<h2>Welcome! Please Fill In Your Information:</h2>
			<br>
		</header>
            <!-- Information to be filled out by user -->
            <br>
            <br>
            <div class = 'wrapper'>
			<section>
				This information will be visible to anyone viewing your profile.
				<form action="createprofile.php" method="POST">
					<label for="Preferences"> Preferences: </label><br>
					<label>Location</label> <input type="text" name="location" placeholder="e.g. United States">
					<br>
					<label>Language</label> <input type="text" name="lang" placeholder="e.g. English">
					<br>
					<label>Description</label> <textarea rows="3" name="description"></textarea>
					<br>
					<!-- Submition here needs to connect to back end of new profile -->
					<button class = 'button-center' onclick = "newUser()"> Finish Profile </button> 
				</form>
			</section>
            </div>
		</body>
	</html>